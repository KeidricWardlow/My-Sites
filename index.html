<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Area Chart</title>
        <link href="https://fonts.googleapis.com/css2?family=Titillium+Web:wght@400&display=swap" rel="stylesheet">
        <style>
            body {
                font-family: 'Titillium Web', sans-serif;
                background: linear-gradient(to right, tan, brown, yellow);
                color: white;
                text-align: center;
                padding: 20px;
            }

            .container {
                max-width: 700px;
                margin: auto;
                width: 100%;
                overflow-x: hidden;
            }

            .point-input {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin: 8px 0;
                align-items: center;
            }

            .point-input input[type="text"],
            .point-input input[type="number"] {
                width: 100%;
                padding: 6px;
                border-radius: 5px;
                border: none;
                box-sizing: border-box;
            }

            canvas {
                margin-top: 20px;
                background: white;
                border-radius: 8px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            }

            button {
                margin-top: 10px;
                cursor: pointer;
                background: darkblue;
                color: white;
                font-size: 16px;
                font-family: "Titillium Web", Times, serif;
                border: none;
                padding: 6px 12px;
                border-radius: 6px;
            }

            button:hover {
                background: linear-gradient(to right, cyan, lime);
                color: black;
            }

            label {
                margin-left: 10px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <div id="inputs-container"></div>
            <button id="add-input">Add Point</button>
            <button id="remove-input">Remove Point</button>
            <button id="undo">Undo</button>
            <button id="redo">Redo</button>
            <br>
            <br>
            <input type="color" id="color-picker" value="#ffff00">
            <label for="file-type">Save as:</label>
            <select id="file-type">
                <option value="png">PNG</option>
                <option value="jpg">JPG</option>
                <option value="webp">WEBP</option>
            </select>
            <input type="text" id="filename-input" placeholder="Enter filename...">
            <button id="save-chart">Save</button>
            <button id="print">Print</button>
            <canvas id="areaChart"></canvas>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            const inputsContainer = document.getElementById('inputs-container');
            const addInputButton = document.getElementById('add-input');
            const removeInputButton = document.getElementById('remove-input');
            const saveChartButton = document.getElementById('save-chart');
            const printButton = document.getElementById('print');
            const areaChartCanvas = document.getElementById('areaChart');
            const colorPicker = document.getElementById('color-picker');
            const filenameInput = document.getElementById('filename-input');
            const fileTypeInput = document.getElementById('file-type');
            const undoButton = document.getElementById('undo');
            const redoButton = document.getElementById('redo');
            let chartInstance;
            const LS_POINTS_KEY = 'areaChart_points';
            const LS_COLOR_KEY = 'areaChart_color';
            const LS_FILENAME_KEY = 'areaChart_filename';
            const LS_FILETYPE_KEY = 'areaChart_filetype';
            let history = [];
            let historyIndex = -1;
            const MAX_HISTORY = 50;

            function getStateSnapshot() {
                return {
                    points: getPointsData(),
                    color: colorPicker.value,
                    filename: filenameInput.value,
                    filetype: fileTypeInput.value
                };
            }

            function applyStateSnapshot(state) {
                if (!state) return;
                inputsContainer.innerHTML = '';
                state.points.forEach(pt => addPoint(pt.label, pt.value));
                colorPicker.value = state.color;
                filenameInput.value = state.filename;
                fileTypeInput.value = state.filetype;
                drawChart();
            }

            function pushHistory() {
                const snapshot = getStateSnapshot();
                history = history.slice(0, historyIndex + 1);
                history.push(JSON.stringify(snapshot));
                if (history.length > MAX_HISTORY) history.shift();
                historyIndex = history.length - 1;
            }

            function undo() {
                if (historyIndex > 0) {
                    historyIndex--;
                    applyStateSnapshot(JSON.parse(history[historyIndex]));
                }
            }

            function redo() {
                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    applyStateSnapshot(JSON.parse(history[historyIndex]));
                }
			}
            function getPointsData() {
                return Array.from(inputsContainer.getElementsByClassName('point-input')).map(container => ({
                    label: container.querySelector('.label-input').value,
                    value: Number(container.querySelector('.value-input').value) || 0
                }));
            }

            function savePointsToLocalStorage() {
                const points = getPointsData();
                localStorage.setItem(LS_POINTS_KEY, JSON.stringify(points));
            }

            function loadPointsFromLocalStorage() {
                const points = JSON.parse(localStorage.getItem(LS_POINTS_KEY) || '[]');
                inputsContainer.innerHTML = '';
                if (points.length === 0) {
                    addPoint("Point 1", "");
                } else {
                    points.forEach(pt => addPoint(pt.label, pt.value));
                }
            }

            function addPoint(label = "", value = "") {
                const div = document.createElement('div');
                div.className = 'point-input';
                div.innerHTML = `
        
										<input type="text" class="label-input" placeholder="Point ${inputsContainer.childElementCount + 1}" value="${label}">
											<input type="number" class="value-input" min="0" value="${value}">
      `;
                inputsContainer.appendChild(div);
                const labelInput = div.querySelector('.label-input');
                const valueInput = div.querySelector('.value-input');
                const triggerUpdate = () => {
                    savePointsToLocalStorage();
                    drawChart();
                    pushHistory();
                };
                labelInput.addEventListener('input', triggerUpdate);
                valueInput.addEventListener('input', triggerUpdate);
            }

            function drawChart() {
                const points = getPointsData();
                const selectedColor = colorPicker.value;
                savePointsToLocalStorage();
                saveOtherSettingsToLocalStorage();
                if (chartInstance) chartInstance.destroy();
                const ctx = areaChartCanvas.getContext('2d');
                chartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: points.map(p => p.label || "Unnamed"),
                        datasets: [{
                            label: 'Data Set',
                            data: points.map(p => p.value),
                            backgroundColor: `${selectedColor}50`,
                            borderColor: selectedColor,
                            borderWidth: 2,
                            fill: true,
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            }

            function saveOtherSettingsToLocalStorage() {
                localStorage.setItem(LS_COLOR_KEY, colorPicker.value);
                localStorage.setItem(LS_FILENAME_KEY, filenameInput.value);
                if (fileTypeInput) localStorage.setItem(LS_FILETYPE_KEY, fileTypeInput.value);
            }

            function loadOtherSettingsFromLocalStorage() {
                const color = localStorage.getItem(LS_COLOR_KEY);
                const filename = localStorage.getItem(LS_FILENAME_KEY);
                const filetype = localStorage.getItem(LS_FILETYPE_KEY);
                if (color) colorPicker.value = color;
                if (filename) filenameInput.value = filename;
                if (fileTypeInput && filetype) fileTypeInput.value = filetype;
            }
            window.addEventListener('DOMContentLoaded', () => {
                loadPointsFromLocalStorage();
                loadOtherSettingsFromLocalStorage();
                drawChart();
                pushHistory();
            });
            addInputButton.addEventListener('click', () => {
                addPoint(`Point ${inputsContainer.childElementCount + 1}`, "");
                savePointsToLocalStorage();
                drawChart();
                pushHistory();
            });
            removeInputButton.addEventListener('click', () => {
                if (inputsContainer.lastChild) {
                    inputsContainer.removeChild(inputsContainer.lastChild);
                    savePointsToLocalStorage();
                    drawChart();
                    pushHistory();
                }
            });
            undoButton.addEventListener('click', undo);
            redoButton.addEventListener('click', redo);
            saveChartButton.addEventListener('click', () => {
                const fileType = fileTypeInput.value;
                const filename = filenameInput.value.trim() || 'chart';
                const link = document.createElement('a');
                link.download = `${filename}.${fileType}`;
                link.href = areaChartCanvas.toDataURL(`image/${fileType}`);
                link.click();
                saveOtherSettingsToLocalStorage();
            });
            printButton.addEventListener('click', () => {
                const filename = filenameInput.value.trim() || 'chart';
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
												<html>
													<body>`);
                printWindow.document.write(`
														<img src="${areaChartCanvas.toDataURL()}" style="width: 100%;"/>`);
                printWindow.document.write(`
													</body>
												</html>`);
                printWindow.document.close();
                printWindow.document.title = filename;
                printWindow.print();
                saveOtherSettingsToLocalStorage();
            });
            colorPicker.addEventListener('input', () => {
                saveOtherSettingsToLocalStorage();
                drawChart();
                pushHistory();
            });
            filenameInput.addEventListener('input', () => {
                saveOtherSettingsToLocalStorage();
                pushHistory();
            });
            if (fileTypeInput) fileTypeInput.addEventListener('change', () => {
                saveOtherSettingsToLocalStorage();
                pushHistory();
            });
        </script>
    </body>
</html>
